---
title: "Flutter: æšæ•°ã«ä¸Šé™ã‚’è¨­ã‘ã¦ã‚®ãƒ£ãƒ©ãƒªãƒ¼ã‹ã‚‰å†™çœŸã‚’é¸æŠã™ã‚‹"
emoji: "ğŸˆ"
type: "tech"
topics: ["android", "flutter", "ios", "dart"]
published: true
---

Flutterã§ã‚®ãƒ£ãƒ©ãƒªãƒ¼ã‹ã‚‰å†™çœŸã‚’é¸æŠã™ã‚‹éš›ã€é¸æŠå¯èƒ½ãªæšæ•°ã«ä¸Šé™ã‚’è¨­ã‘ãŸã„ã‚±ãƒ¼ã‚¹ãŒã‚ã‚Šã¾ã™ãŒã€æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã‚ã‚‹ImagePickerã®pickMultiImageãƒ¡ã‚½ãƒƒãƒ‰ã¯ä¸Šé™æšæ•°ã‚’æŒ‡å®šã§ããªã„ãŸã‚å®Ÿè£…ã™ã‚‹ã“ã¨ãŒå›°é›£ã§ã™ã€‚
ãã“ã§ä»Šå›ã¯ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£ãƒ¼è£½ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ç”¨ã—ã¦ã€æšæ•°ã«ä¸Šé™ã‚’è¨­ã‘ã¦ã‚®ãƒ£ãƒ©ãƒªãƒ¼ã‹ã‚‰å†™çœŸã‚’é¸æŠã™ã‚‹å‡¦ç†ã‚’å®Ÿè£…ã™ã‚‹æ–¹æ³•ã«ã¤ã„ã¦è§£èª¬ã—ã¦ã„ããŸã„ã¨æ€ã„ã¾ã™ã€‚

### ç’°å¢ƒ

- macOS Big Sur 11.5.2
- iPhone11 iOS 15.31
- Flutter 2.8.1
- Dart 2.15.1

### ä½¿ç”¨ã™ã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒª

multi_image_picker2 ... ã‚®ãƒ£ãƒ©ãƒªãƒ¼ã‹ã‚‰å†™çœŸã‚’é¸æŠã™ã‚‹å‡¦ç†ã§ä½¿ç”¨
[https://pub.dev/packages/multi_image_picker2/example](https://pub.dev/packages/multi_image_picker2/example)

flutter_absolute_path ... Assetã‚’Fileã«å¤‰æ›ã™ã‚‹å‡¦ç†ã§ä½¿ç”¨
[https://pub.dev/packages/flutter_absolute_path/versions](https://pub.dev/packages/flutter_absolute_path/versions)

```yaml
dependencies:
  multi_image_picker2: ^5.0.2

  flutter_absolute_path:
    git:
      url: [url_to_fork_repository]

```

flutter_absolute_pathã¯githubã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã‚‹ã‚‚ã®ã¯null_safetyã«å¯¾å¿œã—ã¦ã„ã¾ã™ãŒã€
pubdevã«å…¬é–‹ã•ã‚Œã¦ã„ã‚‹ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒnull_safetyã«å¯¾å¿œã—ã¦ã„ãªã„ã®ã§ã€

1. å®Ÿè¡Œæ™‚ã« --no-sound-null-safety ã‚’ã¤ã‘ã‚‹
2. å…ƒã®ãƒªãƒã‚¸ãƒˆãƒªã‹ã‚‰ãƒ•ã‚©ãƒ¼ã‚¯ã—ã¦ä½¿ç”¨ã™ã‚‹

ã®ã©ã¡ã‚‰ã‹ã®å¯¾å¿œã‚’è¡Œã†å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
ä»Šå›ã¯2ç•ªã®æ–¹æ³•ã‚’æ¡ç”¨ã—ã¾ã—ãŸã€‚

### iOSã®è¨­å®š

ã‚«ãƒ¡ãƒ©ã‚„ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’å¯èƒ½ã«ã™ã‚‹ãŸã‚ã€info.plistã«ä¸‹è¨˜å†…å®¹ã‚’è¿½è¨˜ã—ã¾ã™ã€‚

```plist
<key>NSPhotoLibraryUsageDescription</key>
  <string>This app requires to access your photo library</string>
  <key>NSCameraUsageDescription</key>
  <string>This app requires to add file to your camera</string>
  <key>NSMicrophoneUsageDescription</key>
  <string>This app requires to add file to your photo library your microphone</string>

```

### androidã«å¿…è¦ãªè¨­å®š

åŒæ§˜ã«AndroidManifest.xmlã®<application>ã‚¿ã‚°ã«ä¸‹è¨˜å†…å®¹ã‚’è¿½è¨˜ã—ã¾ã™ã€‚

```xml
<application
            android:requestLegacyExternalStorage="true">
```

### æ—¥æœ¬èªåŒ–

iOSç«¯æœ«ã§multi_image_pickerã®æ—¥æœ¬èªåŒ–ã‚’è¡Œã†ãŸã‚ã«ã€xcodeã§è¨­å®šã‚’è¡Œã„ã¾ã™ã€‚
xcodeã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’é–‹ãã€ã€ŒRunnerã€ â†’ ã€Œinfoã€ â†’ ã€ŒCustom iOS Target Propertiesã€ â†’ ã®é †ã«é¸æŠã—ã€Valueã‚’Japanã«å¤‰æ›´ã—ã¾ã™ã€‚

![https://storage.googleapis.com/zenn-user-upload/b35ccb64bf3c-20220306.png](https://storage.googleapis.com/zenn-user-upload/b35ccb64bf3c-20220306.png)

### ã‚®ãƒ£ãƒ©ãƒªãƒ¼ã‹ã‚‰å†™çœŸã‚’é¸æŠã™ã‚‹

MultiImagePickerã®pickImagesãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã³å‡ºã—ã¦ã€ã‚®ãƒ£ãƒ©ãƒªãƒ¼ã‹ã‚‰å†™çœŸã‚’é¸æŠã—ã¾ã™ã€‚
pickImagesã¯æˆ»ã‚Šå€¤ã¨ã—ã¦ã€Assetã‚¯ãƒ©ã‚¹ã®ãƒªã‚¹ãƒˆã‚’è¿”å´ã—ã¾ã™ã€‚

å¼•æ•°ã®maxImagesã«å€¤ã‚’æ¸¡ã™ã“ã¨ã§ã€é¸æŠã§ãã‚‹ä¸Šé™æšæ•°ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
ã¾ãŸé¸æŠã‚’å®Œäº†ã™ã‚‹ãƒœã‚¿ãƒ³ã®ãƒ©ãƒ™ãƒ«ã¯æ—¥æœ¬èªåŒ–ã—ã¦ã‚‚Doneã®ã¾ã¾ãªã®ã§ã€å¤‰æ›´ã—ãŸã„å ´åˆã¯doneButtonTitleã«å¤‰æ›´å¾Œã®ãƒ©ãƒ™ãƒ«ã‚’æŒ‡å®šã—ãŸCupertinoOptionsã‚’ç”Ÿæˆã—ã€pickImagesã®å¼•æ•°ã«æ¸¡ã—ã¦ã‚ã’ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```dart
List<Asset> assets = await MultiImagePicker.pickImages(
  maxImages: 4,
  cupertinoOptions: const CupertinoOptions(
    doneButtonTitle: 'ä¿å­˜',
  ),
);

```

### Assetã‚’Fileã«å¤‰æ›ã™ã‚‹

Assetã¯ã“ã®ã¾ã¾ã¨æ‰±ã„ã¥ã‚‰ã„ã®ã§ã€Fileã«å¤‰æ›ã—ã¾ã—ã‚‡ã†ã€‚
Assetã‚’Fileã«å¤‰æ›ã™ã‚‹éš›ã¯ã€FlutterAbsolutePathã®getAbsolutePathãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

Assetã®identifierã‚’getAbsolutePathãƒ¡ã‚½ãƒƒãƒ‰ã«å¼•æ•°ã¨ã—ã¦æ¸¡ã™ã“ã¨ã§ã€çµ¶å¯¾ãƒ‘ã‚¹ã‚’å–å¾—ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
ã“ã“ã§å–å¾—ã—ãŸçµ¶å¯¾ãƒ‘ã‚¹ã‚’ä½¿ç”¨ã—ã¦Fileã‚’ç”Ÿæˆã™ã‚‹ã“ã¨ã§ã€Assetã‚’Fileã«å¤‰æ›ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

```dart
final files = <File>[];

await Future.wait(
  assets.map(
    (e) async {
      final path = await FlutterAbsolutePath.getAbsolutePath(e.identifier!);
      final file = File(path!);
      files.add(file);
    },
  ),
);

```

### é–¢æ•°åŒ–ã™ã‚‹

ã“ã“ã¾ã§ã§å‡¦ç†ã®å®Ÿè£…ã¯å®Œäº†ã—ã¾ã—ãŸã®ã§ã€é–¢æ•°åŒ–ã—ã¦ä½¿ã„ã¾ã‚ã›ã‚‹ã‚ˆã†ã«ã—ã¾ã—ã‚‡ã†ã€‚

```dart
import 'dart:io';

import 'package:multi_image_picker2/multi_image_picker2.dart';
import 'package:flutter_absolute_path/flutter_absolute_path.dart';

class ImageUtils {
  static Future<List<File>> pickLimitedMultiImage({
    int maxImages = 4,
  }) async {
    List<Asset> assets = await MultiImagePicker.pickImages(
      maxImages: maxImages,
      cupertinoOptions: const CupertinoOptions(
        doneButtonTitle: 'ä¿å­˜',
      ),
    );

    final files = <File>[];

    await Future.wait(
      assets.map(
        (e) async {
          final path = await FlutterAbsolutePath.getAbsolutePath(e.identifier!);
          final file = File(path!);
          files.add(file);
        },
      ),
    );

    return files;
  }
}

```

### ä½¿ã£ã¦ã¿ã‚‹

æœ€å¾Œã«é–¢æ•°ã‚’ä½¿ç”¨ã—ãŸWidgetã‚’ä½œæˆã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚
ä»Šå›ã¯ã€ã‚®ãƒ£ãƒ©ãƒªãƒ¼ã‹ã‚‰ç”»åƒã‚’é¸æŠã—ä»»æ„ã®å‡¦ç†ã‚’è¡Œã†ãƒœã‚¿ãƒ³ã‚’ä½œæˆã—ã¾ã™ã€‚

```dart
import 'dart:io';

import 'package:flutter/material.dart';
import 'package:playport/utils/image_utils.dart';

class ImageSelectButton extends StatelessWidget {
  const ImageSelectButton({
    Key? key,
    this.maxImages = 4,
    required this.onPressed,
  }) : super(key: key);

  final int maxImages;
  final Function(List<File>) onPressed;

  @override
  Widget build(BuildContext context) {
    return IconButton(
      icon: const Icon(Icons.photo_library_outlined),
      onPressed: () async {
        List<File>? files = await ImageUtils.pickLimitedMultiImage(
          maxImages: maxImages,
        );

        if (files != null) {
          onPressed(files);
        }
      },
    );
  }
}

```
